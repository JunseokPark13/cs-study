# 경쟁 상태

## 경쟁 상태 (Race Condition)란
+ 공유 자원에 대해 여러 프로세스가 동시에 접근할 때, 결과값에 영향을 줄 수 있는 상태를 뜻한다.
+ 접근하는 순서, 프로세스의 실행 기간 등에 영향을 받기 때문에 매번 실행 결과가 달라지게 된다.
+ 동시 접근 시 자료의 일관성을 해치는 결과가 나타날 수 있다.
+ 경쟁 상태도 교착 상태의 종류 중 하나라고 볼 수 있다.

### 경쟁 상태가 일어날 수 있는 시나리오

<br>

![image](https://user-images.githubusercontent.com/49611158/147401406-f5981e26-49ce-4944-a381-17acd3a470e0.png)

<br>

1. 두 프로세스 P1, P2 가 있다.
2. 두 프로세스의 수행 시간은 동일하다.
3. 두 프로세스의 연산은 서로 다르다.'
4. 두 프로세스는 동일한 공유 데이터의 값을 읽고, 각자 다른 연산을 수행하여 이를 저장한다.

<br>

## 경쟁 상태가 발생하는 경우

### 커널 작업을 수행하는 중에 인터럽트 발생
+ 문제점 : 커널모드에서 데이터를 로드하여 작업을 수행 중 인터럽트가 발생하여 같은 데이터를 조작하는 경우
+ 해결법 : 커널 모드에서 작업을 수행하는 동안, 인터럽트를 비활성화하여 CPU 제어권을 가져가지 못하도록 한다.

### 프로세스가 System Call을 하여 커널 모드로 진입 후 작업을 수행하는 도중 문맥 교환이 발생할 때
+ 문제점 : 프로세스1이 커널모드에서 데이터 조작 도중, 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가 같은 데이터를 조작한다면 프로세스1가 작업에 반영되지 않는다.
+ 해결법 : 프로세스가 커널모드에서 작업을 하는 경우, 시간이 초과되어도 CPU 제어권이 다른 프로세스에게 넘어가지 않도록 함

### 멀티 프로세스 환경에서 공유 메모리 내의 커널 데이터에 접근할 때
+ 문제점 : 멀티 프로세서 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우
+ 해결법 : 커널 내부에 있는 각 공유 데이터에 접근 할 때 마다 그 데이터에 대한 lock/unlock을 하는 방법 