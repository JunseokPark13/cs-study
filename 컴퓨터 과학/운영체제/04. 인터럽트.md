# 인터럽트 (Interrupt)

## 인터럽트란
+ CPU 가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 예외상황이 발생하여 처리가 필요할 경우, 마이크로프로세서에게 알려 처리할 수 있도록 하는 것
+ 현재 실행 중인 작업을 중단하고, 발생된 상황을 처리한 뒤 다시 실행 중인 작업으로 복귀한다.

<br>

## 인터럽트의 종류

### 하드웨어 인터럽트
+ 하드웨어가 발생시키는 인터럽트로, CPU가 아닌 다른 하드웨어 장치가 cpu에 어떤 사실을 알려주거나 cpu 서비스를 요청해야 할 경우 발생시킨다.
+ 외부 인터럽트
    - 전원 이상 인터럽트 : 정전, 파워 이상 등
    - 기계 착오 인터럽트 : CPU 의 기능적인 오류
    - 외부 신호 인터럽트
        + 타이머에 의한 인터럽트 : 자원이 할당된 시간이 다 끝난 경우
        + 키보드로 인터럽트 키를 누른 경우 : Ctrl + Alt + Delete 등
        + 외부장치로부터 인터럽트 요청이 있는 경우
    - 입출력 인터럽트 (I/O Interrupt)
        + 입출력 장치가 데이터 전송을 요구하거나 전송이 끝나 다음 동작이 수행되어야 할 경우
        + 입출력 데이터에 이상이 있는 경우
+ 내부 인터럽트
    - 잘못된 명령이나 잘못된 데이터를 사용할 때 발생하며, Trap 이라고 부름
    - 프로그램 검사 인터럽트
        + Division by zero
        + Overflow / Underflow
        + 기타 Exception
    - 소프트웨어적인 내용이지만, 분류상 인터럽트가 아님

### 프트웨어 인터럽트 (SVC : SuperVisor Call)
- 사용자가 프로그램을 실행시키거나 감시프로그램을 호출하는 동작을 수행하는 경우
- 소프트웨어 이용 중 다른 프로세스 실행 시, 시분할 처리를 위해 자원 할당 등의 동작이 수행됨

<br>

## 인터럽트 동작 순서

<br>

![image](https://user-images.githubusercontent.com/49611158/146925848-c7d26735-8866-49aa-9eae-1da8b1a6d43a.png)

<br>

1. 장치가 인터럽트 신호를 CPU 에게 보낸다.
2. CPU 는 실행 중인 명령어를 완료시키고, 인터럽트 신호를 확인한다.
3. 현재 수행 중인 프로그램 상태 정보를 시스템 스택에 저장한다. (PCB; Process Control Block, PC; Program Counter)
4. 인터럽트 처리 루틴 실행 : 인터럽트를 요청한 장치를 식별한다.
5. 인터럽트 서비스 루틴 실행 (ISR) : 인터럽트 원인을 파악하고 실질적인 작업을 수행한다.
    + 서비스 루틴 수행 중 우선순위가 더 높은 인터럽트가 발생하면 또 재귀적으로 1 ~ 5를 수행한다.
6. 인터럽트 발생 시 저장해둔 PC(Program Counter)를 다시 복구한다.
7. 중단된 프로그램 실행 재개 : PC 값을 이용하여 이전에 수행 중이던 프로그램을 재개한다. 

<br>

## 인터럽트 우선순위
+ 여러 장치에서 인터럽트가 동시에 발생하거나, 인터럽트 서비스 루틴 수행 중 인터럽트가 발생했을 경우, 우선순위를 따져서 처리한다.

+ 전원 이상(Power fall) > 기계 착오(Machine Check) > 외부 신호(External) > 입출력(I/O) > 명령어 잘못 > 프로그램 검사(Program Check) > SVC(SuperVisor Call)

+ 일반적으로 하드웨어 인터럽트가 소프트웨어 인터럽트보다 우선 순위가 높고, 내부 인터럽트보다 외부 인터럽트 우선 순위가 높다.

<br>

## 인터럽트 우선순위 판별 방법

### 소프트웨어적인 방법 (Polling)
+ 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾고, 이에 해당하는 인터럽트 서비스 루틴을 수행한다.
+ 우선순위 변경이 쉽지만, 많은 인터럽트가 있을 경우 하드웨어 적인 방법에 비해 우선순위 판단 속도가 느리다.
+ 회로가 간단하고 융통성이 있으며, 별도의 하드웨어가 필요 없다.

### 하드웨어적인 방법 (Vectored Interrupt)
+ 인터럽트를 요청할 수 있는 장치와 CPU 사이에 장치 번호를 식별할 수 있는 버스를 직렬/병렬로 연결한다.
+ 인터럽트 벡터는 인터럽트를 발생한 장치가 분기할 곳에 대한 정보이다.
+ 회로가 복잡하지만, 별도의 소프트웨어가 필요없이 하드웨어로 처리되므로 속도가 빠른 편이다.
+ Daisy Chain
    - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결한다.
    - 우선순위가 높은 장치를 상위에 두고, 우선순위 차레대로 배치한다.
+ 병렬 우선순위 부여 방식
    - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결한다.
    - 각 장치별 우선순위를 판별하기 위한 Mask Register 에 bit를 설정한다.
    - Mask Resigter 상 우선순위가 높은 서비스 루틴 수행 중 우선순위가 낮은 bit 들을 비활성화 시킬 수 있다.
    - 반대로 우선순위가 높은 인터럽트는 낮은 인터럽트 수행 중에도 우선 처리된다. 